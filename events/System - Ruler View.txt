namespace = wwu_ruler_view

# Realm Management
country_event = {
	id = wwu_ruler_view.1
	title = wwu_ruler_view.1.title
	desc = wwu_ruler_view.1.desc
	picture = RULER_VIEW_eventPicture
	
	is_triggered_only = yes
    
    # Undergo Class Training
    option = {
		name = wwu_ruler_view.1.option.class_training
        
        trigger = {
            NOT = { has_assigned_ruler_class = yes }
            NOT = { has_ruler_flag = ruler_is_training }
            
            if = {
                limit = {
                    NOT = { has_idea = wwu_administrative_ideas_7}
                }
                adm_power = 100
                dip_power = 100
                mil_power = 100
            }
        }
        
        if = {
            limit = {
                NOT = { has_idea = wwu_administrative_ideas_7}
            }
            add_adm_power = -100
            add_dip_power = -100
            add_mil_power = -100
        }
        
        country_event = { id = wwu_ruler_training.1 }
        
        ai_chance = {
            factor = 1
            
            modifier = {
                factor = 0
                
                NOT = { adm_power = 500 }
                NOT = { dip_power = 500 }
                NOT = { mil_power = 500 }
            }
        }
	}
    
    # Undergo Class Training - Lack Requirements
    option = {
		name = wwu_ruler_view.1.option.class_training.lack_requirement
        
        trigger = {
            NOT = { has_assigned_ruler_class = yes }
            NOT = { has_ruler_flag = ruler_is_training }
            
            NOT = { adm_power = 100 }
            NOT = { dip_power = 100 }
            NOT = { mil_power = 100 }
        }
        
        custom_tooltip = NEED_CLASS_TRAINING_REQUIREMENT
        
        ai_chance = {
            factor = 0
        }
	}
    
    # Undergo Magical Training
    option = {
		name = wwu_ruler_view.1.option.magical_training
        
        trigger = {
            has_global_flag = enabled_magic_mechanics
            NOT = { has_ruler_modifier = spellcaster_capabilities }
            NOT = { has_ruler_modifier = magical_training }
            
            if = {
                limit = {
                    OR = {
                        has_ruler_flag = mage_personality
                        has_ruler_flag = priest_personality
                        has_ruler_flag = warlock_personality
                        has_ruler_flag = druid_personality
                        has_reform = wwu_magic_free_magic
                    }
                }
                
                adm_power = 100
                dip_power = 100
                mil_power = 100
            }
            else_if = {
                limit = {
                    OR = {
                        has_reform = wwu_magic_magical_society
                        has_reform = wwu_magic_dalaran_education
                    }
                }
                
                adm_power = 50
                dip_power = 50
                mil_power = 50
            }
            else = {
                adm_power = 200
                dip_power = 200
                mil_power = 200
            }
        }
        
        if = {
            limit = {
                OR = {
                    has_ruler_flag = mage_personality
                    has_ruler_flag = priest_personality
                    has_ruler_flag = warlock_personality
                    has_ruler_flag = druid_personality
                    has_reform = wwu_magic_free_magic
                }
            }
            
            add_adm_power = -100
            add_dip_power = -100
            add_mil_power = -100
        }
        else_if = {
            limit = {
                OR = {
                    has_reform = wwu_magic_magical_society
                    has_reform = wwu_magic_dalaran_education
                }
            }
            
            add_adm_power = -50
            add_dip_power = -50
            add_mil_power = -50
        }
        else = {
            add_adm_power = -200
            add_dip_power = -200
            add_mil_power = -200
        }
        
        add_ruler_modifier = {
            name = magical_training
            duration = 3650
        }
        
        custom_tooltip = MAGIC_UNDERGO_TRAINING
        
        # Play failure event if the ruler isn't a spellcaster by the end
        hidden_effect = {
            country_event = { id = wwu_magic.12 days = 3650 }
        }
        
        # Add free points based on monarch skill
        # Only do it for the first instance of the decision
        hidden_effect = {
            if = {
                limit = {
                    is_variable_equal = {
                        which = ruler_magic_training
                        value = 0
                    }
                }
                if = {
                    limit = {
                        adm = 5
                    }
                    add_magical_training_point = yes
                }
                if = {
                    limit = {
                        dip = 5
                    }
                    add_magical_training_point = yes
                }
                if = {
                    limit = {
                        mil = 5
                    }
                    add_magical_training_point = yes
                }
            }
        }
        
        ai_chance = {
            factor = 1
            
            modifier = {
                factor = 0
                
                NOT = { adm_power = 600 }
                NOT = { dip_power = 600 }
                NOT = { mil_power = 600 }
            }
        }
	}
    
    # Undergo Magical Training - Lack Requirements
    option = {
		name = wwu_ruler_view.1.option.magical_training.lack_requirement
        
        trigger = {
            has_global_flag = enabled_magic_mechanics
            NOT = { has_ruler_modifier = spellcaster_capabilities }
            NOT = { has_ruler_modifier = magical_training }
            
            if = {
                limit = {
                    OR = {
                        has_ruler_flag = mage_personality
                        has_ruler_flag = priest_personality
                        has_ruler_flag = warlock_personality
                        has_ruler_flag = druid_personality
                        has_reform = wwu_magic_free_magic
                    }
                }
                
                NOT = { adm_power = 100 }
                NOT = { dip_power = 100 }
                NOT = { mil_power = 100 }
            }
            else_if = {
                limit = {
                    OR = {
                        has_reform = wwu_magic_magical_society
                        has_reform = wwu_magic_dalaran_education
                    }
                }
                
                NOT = { adm_power = 50 }
                NOT = { dip_power = 50 }
                NOT = { mil_power = 50 }
            }
            else = {
                NOT = { adm_power = 200 }
                NOT = { dip_power = 200 }
                NOT = { mil_power = 200 }
            }
        }
        
        if = {
            limit = {
                OR = {
                    has_ruler_flag = mage_personality
                    has_ruler_flag = priest_personality
                    has_ruler_flag = warlock_personality
                    has_ruler_flag = druid_personality
                }
            }
            
            custom_tooltip = NEED_MAGICAL_TRAINING_REQUIREMENT_MAGE
        }
        else = {
            custom_tooltip = NEED_MAGICAL_TRAINING_REQUIREMENT
        }
        
        ai_chance = {
            factor = 0
        }
	}
    
    # Improve Magical Skill
    option = {
		name = wwu_ruler_view.1.option.magical_skill_training
        
        trigger = {
            has_global_flag = enabled_magic_mechanics
            has_ruler_modifier = spellcaster_capabilities
            NOT = { has_ruler_modifier = recently_trained_magic }
        }
        
        country_event = { id = wwu_magic.60 }
        
        ai_chance = {
            factor = 1
            
            modifier = {
                factor = 0
                
                NOT = { adm_power = 800 }
                NOT = { dip_power = 800 }
                NOT = { mil_power = 800 }
            }
        }
	}
    
    # Retire [Root.Monarch.GetName]
    option = {
		name = wwu_ruler_view.1.option.retire
        
        trigger = {
            months_of_ruling = 64 # Must have ruled for 5 years minimum. Prevents exploitative ruler cycling
        }
        
        exile_ruler_as = { 
            name = former_ruler
        }
        
        if = {
            limit = {
                NOT = { legitimacy_equivalent = 50 }
            }
            add_stability = 1
        }
        
        ai_chance = {
            factor = 0
        }
	}
    
    # Sacrifice [Root.Monarch.GetName]
    option = {
		name = wwu_ruler_view.1.option.sacrifice
        
        trigger = {
            NOT = { ADM = 2 }
            NOT = { DIP = 2 }
            NOT = { MIL = 2 }
        }
        
        kill_ruler = yes
        add_prestige = -50
        
        ai_chance = {
            factor = 0
        }
	}
    
    option = {
		name = wwu_ruler_view.1.option.exit
        
        ai_chance = {
            factor = 1
        }
	}
}

