namespace = wwu_scourge

#-------------------------------------------
# Main Events
#-------------------------------------------
# Ner'zhul's Arrival to Icecrown Citadel
country_event = {
	id = wwu_scourge.1
	title = wwu_scourge.1.title
	desc = wwu_scourge.1.desc
	picture = ICECROWN_CITADEL_eventPicture

    major = yes
    
	trigger = {
        NOT = { has_global_flag = nerzhul_arrived }
        
        ai = no
        
        # Only occur in starts before Rise of the Lich King
        is_year = 604
        NOT = { is_year = 605 }
	}
	
	mean_time_to_happen = { 
        days = 1
    }
    
	immediate = {
		hidden_effect = { set_global_flag = nerzhul_arrived }
    }
	
	option = {
		name = wwu_scourge.1.option.a
		
        custom_tooltip = SCOURGE_APPEARS_TT
        
        hidden_effect = {
            # Icecrown Citadel
            1268 = {
                cede_province = P11
                add_core = P11
                add_base_tax = 8
                add_base_production = 8
                add_base_manpower = 8
                add_building = wow_fort_1
                change_religion = cult_of_the_damned
                change_culture = culture_scourge
                change_trade_goods = saronite
                infantry = P11
                infantry = P11
                infantry = P11
                infantry = P11
                infantry = P11
                cavalry = P11
                cavalry = P11
                artillery = P11
    
                add_province_triggered_modifier = seat_of_the_lich_king
            }
            
            area_icecrown_interior = {
                cede_province = P11
                add_core = P11
                change_religion = cult_of_the_damned
                change_culture = culture_scourge
                change_trade_goods = saronite
            }
            
            # Frozen Passage
            3223 = {
                cede_province = P11
                add_core = P11
                change_religion = cult_of_the_damned
                change_culture = culture_scourge
            }
            
            # Corp'rethar
            1267 = {
                cede_province = P11
                add_core = P11
                add_base_tax = 1
                add_base_production = 1
                add_base_manpower = 2
                change_religion = cult_of_the_damned
                change_culture = culture_scourge
                change_trade_goods = saronite
            }

            # The Scourge
            P11 = {
                define_ruler = {
                    name = "Ner'zhul"
                    dynasty = "Shadowmoon" 	
                    adm = 6
                    dip = 6	
                    mil = 6	
                    age = 80
                    claim = 100
                }
                set_ruler_flag = is_immortal
                set_ruler_flag = warlock_personality
                set_ruler_flag = ruler_portrait_nerzhul
    
                setup_spellcaster_history = {
                    APTITUDE = 4
                    FINESSE = 4
                    CONCENTRATION = 5
                    MANA = 5
                    necromancy = yes
                }
                
                set_capital = 1268
                
                add_adm_power = 300
                add_dip_power = 300
                add_mil_power = 300
                add_treasury = 1000
                add_manpower = 25
                
                add_country_modifier = {
                    name = helm_of_domination
                    duration = -1
                }
                
                add_country_modifier = {
                    name = nathrezim_jailors
                    duration = -1
                }
            
                add_country_modifier = {
                    name = nerzhuls_fervor
                    duration = 10950
                }
            }
        }
	}
}

# Scourge Invasion
country_event = {
	id = wwu_scourge.2
	title = wwu_scourge.2.title
	desc = wwu_scourge.2.desc
	picture = UNDEAD_ASSAULT_eventPicture

    is_triggered_only = yes
    
	mean_time_to_happen = { 
        days = 1
    }
    
	option = {
		name = wwu_scourge.2.option.a
		
        hidden_effect = {
            set_country_flag = scourge_invasion
        }
        
        swap_non_generic_missions = yes
        
        # Help the AI with the Kil'Jaeden's Invasion Plan mission
        if = {
            limit = {
                ai = yes
            }
            
            country_event = { id = wwu_scourge.200 days = 90 }
        }
	}
}

# Conversion of Jotunheim
country_event = {
	id = wwu_scourge.10
	title = wwu_scourge.10.title
	desc = wwu_scourge.10.desc
	picture = UNDEAD_ASSAULT_eventPicture

    is_triggered_only = yes
    
	mean_time_to_happen = { 
        days = 1
    }
    
	option = {
		name = wwu_scourge.10.option.a
		
        set_ruler_religion = cult_of_the_damned
        
        if = {
            limit = {
                has_heir = yes
            }
            set_heir_religion = cult_of_the_damned
        }
        
        capital_scope = {
            change_religion = cult_of_the_damned
        }
        
        ai_chance = {
            factor = 100
        }
	}
    option = {
		name = wwu_scourge.10.option.b
		
        add_stability = 1
        
        ai_chance = {
            factor = 0
        }
	}
}

# [Root.GetName] Loyalty
country_event = {
	id = wwu_scourge.11
	title = wwu_scourge.11.title
	desc = wwu_scourge.11.desc
	picture = LICH_KING_CLOSE_eventPicture

    is_triggered_only = yes
    
	mean_time_to_happen = { 
        days = 1
    }
    
	option = {
		name = wwu_scourge.11.option.a
		
        change_religion = cult_of_the_damned
        create_alliance = P11
	}
}

# Lich King's Punishment
country_event = {
	id = wwu_scourge.12
	title = wwu_scourge.12.title
	desc = wwu_scourge.12.desc
	picture = LICH_KING_CLOSE_eventPicture

    is_triggered_only = yes
    
	mean_time_to_happen = { 
        days = 1
    }
    
	option = {
		name = wwu_scourge.12.option.a
		
        random_owned_province = {
            spawn_rebels = {
                type = scourge_rebels
                size = 3
            }
        }
	}
}

# Construction of Icecrown Citadel
province_event = {
	id = wwu_scourge.13
	title = wwu_scourge.13.title
	desc = wwu_scourge.13.desc
	picture = ICECROWN_CITADEL_eventPicture

    is_triggered_only = yes
    
	mean_time_to_happen = { 
        days = 1
    }
    
	option = {
		name = wwu_scourge.13.option.a
		
        center_of_trade = 1
        
        add_base_production = 5
        add_base_manpower = 5
        
        add_building = wow_fort_2
        
        add_permanent_province_modifier = { 
            name = icecrown_province
            duration = -1
        }
	}
}

# Corruption of Sindragosa's Brood
country_event = {
	id = wwu_scourge.14
	title = wwu_scourge.14.title
	desc = wwu_scourge.14.desc
	picture = LICH_KING_eventPicture

    is_triggered_only = yes
    
	mean_time_to_happen = { 
        days = 1
    }
    
	option = {
		name = wwu_scourge.14.option.a
		
        if = {
            limit = {
                exists = SNB
            }
            
            inherit = SNB
        }
        
        # Sindragosa's Fall
        777 = {
            add_base_manpower = 4
            change_culture = culture_scourge
            change_religion = cult_of_the_damned
            change_trade_goods = flying_mounts
        }
        # East Sindragosa's Peaks
        895 = {
            add_base_manpower = 2
            change_culture = culture_scourge
            change_religion = cult_of_the_damned
            change_trade_goods = flying_mounts
        }
        # West Sindragosa's Peaks
        3261 = {
            add_base_manpower = 2
            change_culture = culture_scourge
            change_religion = cult_of_the_damned
            change_trade_goods = flying_mounts
        }
        # Sindragosa's Fall Nest
        3257 = {
            add_base_manpower = 2
            change_culture = culture_scourge
            change_religion = cult_of_the_damned
            change_trade_goods = flying_mounts
        }
        add_country_modifier = {
            name = frostbrood
            duration = -1
        }
	}
}

# Construction of Corp'Rethar
province_event = {
	id = wwu_scourge.15
	title = wwu_scourge.15.title
	desc = wwu_scourge.15.desc
	picture = ICECROWN_CITADEL_eventPicture

    is_triggered_only = yes
    
	mean_time_to_happen = { 
        days = 1
    }
    
	option = {
		name = wwu_scourge.15.option.a
		
        add_base_manpower = 3
        
        add_or_improve_arsenal = yes
        add_or_improve_barracks = yes
        
        add_permanent_province_modifier = { 
            name = scourge_fortification_province
            duration = -1
        }
	}
}

# Construction of the Shadow Vault
province_event = {
	id = wwu_scourge.16
	title = wwu_scourge.16.title
	desc = wwu_scourge.16.desc
	picture = ICECROWN_CITADEL_eventPicture

    is_triggered_only = yes
    
	mean_time_to_happen = { 
        days = 1
    }
    
	option = {
		name = wwu_scourge.16.option.a
		
        add_base_tax = 2
        add_base_production = 2
        add_base_manpower = 2
        
        add_or_improve_arsenal = yes
        add_or_improve_barracks = yes
        add_or_improve_temple = yes
        
        change_trade_goods = mounts
        
        change_culture = culture_death_knight
        change_religion = cult_of_the_damned
	}
}

# Construction of Mord'Rethar
province_event = {
	id = wwu_scourge.17
	title = wwu_scourge.17.title
	desc = wwu_scourge.17.desc
	picture = ICECROWN_CITADEL_eventPicture

    is_triggered_only = yes
    
	mean_time_to_happen = { 
        days = 1
    }
    
	option = {
		name = wwu_scourge.17.option.a
		
        add_or_improve_arsenal = yes
        add_or_improve_barracks = yes
        
        change_culture = culture_scourge
        change_religion = cult_of_the_damned
        
        add_permanent_province_modifier = { 
            name = scourge_fortification_province
            duration = -1 
        }
	}
}

# Construction of the Fleshwerks
province_event = {
	id = wwu_scourge.18
	title = wwu_scourge.18.title
	desc = wwu_scourge.18.desc
	picture = ICECROWN_CITADEL_eventPicture

    is_triggered_only = yes
    
	mean_time_to_happen = { 
        days = 1
    }
    
	option = {
		name = wwu_scourge.18.option.a
		
        add_base_production = 8
        
        add_building = wow_manufactory
        add_or_improve_mine = yes
        
        change_trade_goods = warbeasts
        change_culture = culture_scourge
	}
}

# Construction of Aldur'Thar
province_event = {
	id = wwu_scourge.19
	title = wwu_scourge.19.title
	desc = wwu_scourge.19.desc
	picture = ICECROWN_CITADEL_eventPicture

    is_triggered_only = yes
    
	mean_time_to_happen = { 
        days = 1
    }
    
	option = {
		name = wwu_scourge.19.option.a
		
        add_base_manpower = 4
        add_or_improve_arsenal = yes
        add_or_improve_barracks = yes
        change_culture = culture_scourge
        change_religion = cult_of_the_damned
        change_trade_goods = saronite
        
        add_permanent_province_modifier = { 
            name = scourge_fortification_province
            duration = -1
        }
	}
}

# Construction of Angrathar
province_event = {
	id = wwu_scourge.20
	title = wwu_scourge.20.title
	desc = wwu_scourge.20.desc
	picture = LICH_KING_eventPicture

    is_triggered_only = yes
    
	mean_time_to_happen = { 
        days = 1
    }
    
	option = {
		name = wwu_scourge.20.option.a
		
        add_base_tax = 1
        add_base_production = 1
        add_base_manpower = 4
        
        add_or_improve_fort = yes
        add_or_improve_arsenal = yes
        add_or_improve_barracks = yes
        
        change_culture = culture_scourge
        change_religion = cult_of_the_damned
        
        change_trade_goods = saronite
        
        add_permanent_province_modifier = { 
            name = scourge_fortification_province
            duration = -1
        }
	}
}

# Recruitment of Kel'Thuzad (Scourge)
country_event = {
	id = wwu_scourge.30
	title = wwu_scourge.30.title
	desc = wwu_scourge.30.desc
	picture = ANCIENT_MAGE_eventPicture

    is_triggered_only = yes
    
	mean_time_to_happen = { 
        days = 1
    }
    
	option = {
		name = wwu_scourge.30.option.a
		
        add_adm_power = 150
        add_church_power = 25
        add_prestige = 25
	}
}

# Recruitment of Kel'Thuzad (Dalaran)
country_event = {
	id = wwu_scourge.31
	title = wwu_scourge.31.title
	desc = wwu_scourge.31.desc
	picture = ANCIENT_MAGE_eventPicture

    is_triggered_only = yes
    
	mean_time_to_happen = { 
        days = 1
    }
    
	option = {
		name = wwu_scourge.31.option.a
		
        add_stability = -1
	}
}

# Cult of the Damned
country_event = {
	id = wwu_scourge.32
	title = wwu_scourge.32.title
	desc = wwu_scourge.32.desc
	picture = SCHOLOMANCE_eventPicture

    is_triggered_only = yes
    major = yes
    
	mean_time_to_happen = { 
        days = 1
    }
    
	option = {
		name = wwu_scourge.32.option.a
		
        # Scholomance
        790 = {
            cede_province = P12 # Cult of the Damned
            add_core = P12 # Cult of the Damned

            add_or_improve_temple = yes
            add_or_improve_arsenal = yes
            add_or_improve_barracks = yes
            add_or_improve_farm = yes
            add_or_improve_fort = yes
        
            change_trade_goods = fel
            add_base_tax = 4
            add_base_production = 4
            add_base_manpower = 6
            center_of_trade = 2
        }
        area_scholomance = {
            cede_province = P12 # Cult of the Damned
            add_core = P12 # Cult of the Damned
            change_religion = cult_of_the_damned
            change_culture = culture_cultist
        }
	}
    
    after = {
        hidden_effect = {
            P12 = {
                country_event = { id = wwu_scourge.33 }
            }
        }
    }
}

# Rise of the Damned
country_event = {
	id = wwu_scourge.33
	title = wwu_scourge.33.title
	desc = wwu_scourge.33.desc
	picture = SCHOLOMANCE_eventPicture

    is_triggered_only = yes
    
	mean_time_to_happen = { 
        days = 1
    }
    
	option = {
		name = wwu_scourge.33.option.a
		
        add_government_reform = scourge_domain_reform
        set_capital = 790
        
        define_ruler = {
                name = "Kel'Thuzad"
                adm = 6
                dip = 5
                mil = 5
                age = 75
                claim = 100
        }
        set_ruler_flag = is_immortal
        set_ruler_flag = mage_personality
        
        set_ruler_flag = ruler_portrait_portrait_kelthuzad
    
        setup_spellcaster_history = {
            APTITUDE = 5
            FINESSE = 5
            CONCENTRATION = 5
            MANA = 5
            necromancy = yes
        }
        
        P11 = {
            create_subject = {
                subject_type = vassal
                subject = ROOT
            }
        }
	}
}


# Undead Plague in [Root.GetName]
province_event = {
	id = wwu_scourge.34
	title = wwu_scourge.34.title
	desc = wwu_scourge.34.desc
	picture = POISON_SEEDS_eventPicture

    is_triggered_only = yes
    
	mean_time_to_happen = { 
        days = 1
    }
    
	option = {
		name = wwu_scourge.34.option.a
		
        spawn_rebels = {
            type = scourge_cultist_rebels
            size = 2
        }
	}
}

# Undead Plague in [Root.GetName] - Random
province_event = {
	id = wwu_scourge.35
	title = wwu_scourge.35.title
	desc = wwu_scourge.35.desc
	picture = POISON_SEEDS_eventPicture

    trigger = {
        has_global_flag = undead_plague_active
        
        OR = {
            owned_by = A08
            owner = {
                is_subject_of = A08
            }
        }
        # Limit random plagues to 5 incidents once Scourge of Lordaeron are of a decent size
        if = {
            limit = {
                P52 = {
                    num_of_cities = 10
                }
            }
        
            NOT = {
                check_variable = {
                    which = undead_plague_counter
                    value = 5
                }
            }
        }
    }
    
	mean_time_to_happen = { 
        months = 120
        
        modifier = {
            factor = 3
            
            owner = {
                tag = A08
                has_country_modifier = mission_uthers_investigations
            }
        }
    }
    
    immediate = {
        hidden_effect = {
            if = {
                limit = {
                    P52 = {
                        num_of_cities = 10
                    }
                }
                change_variable = {
                    which = undead_plague_counter
                    value = 1
                }
            }
        }
    }
    
	option = {
		name = wwu_scourge.35.option.a
		
        spawn_rebels = {
            type = scourge_cultist_rebels
            size = 3
        }
	}
}

# Prince Arthas - Ensure Prince Arthas is the heir of Lordaeron during the Scourge of Lordaeron stuff
country_event = {
	id = wwu_scourge.36
	title = wwu_scourge.36.title
	desc = wwu_scourge.36.desc
	picture = ARTHAS_MENETHIL_eventPicture

    trigger = {
        has_global_flag = undead_plague_active
        
        tag = A08

        NOT = { has_heir = "Arthas" }
    }
    
	mean_time_to_happen = { 
        days = 1
    }

	option = {
		name = wwu_scourge.36.option.a
		
        define_heir = { 
            name = "Arthas"
            dynasty = "Menethil" 
            adm = 4
            dip = 2
            mil = 6 
            age = 20
            claim = 100
        }
	}
}

# Fall of Kel'Thuzad
country_event = {
	id = wwu_scourge.37
	title = wwu_scourge.37.title
	desc = wwu_scourge.37.desc
	picture = KELTHUZAD_CLOSEUP_eventPicture

    is_triggered_only = yes
    
	mean_time_to_happen = { 
        days = 1
    }

	option = {
		name = wwu_scourge.37.option.a
		
        P12 = {
            kill_ruler = yes
        }
        
        hidden_effect = {
            set_global_flag = kelthuzad_human_dead
        }
	}
}

# Scourge of Stratholme
province_event = {
	id = wwu_scourge.38
	title = wwu_scourge.38.title
	desc = wwu_scourge.38.desc
	picture = STRATHOLME_eventPicture

    is_triggered_only = yes
    
	mean_time_to_happen = { 
        days = 1
    }
    
	option = {
		name = wwu_scourge.38.option.a
		
        add_or_improve_temple = yes
        add_or_improve_fort = yes
        
        add_permanent_province_modifier = { 
            name = necropolis_province
            duration = -1
        }
	}
}

# Mal'Ganis takes Control
country_event = {
	id = wwu_scourge.39
	title = wwu_scourge.39.title
	desc = wwu_scourge.39.desc
	picture = DEMONIC_PRESENCE_eventPicture

    is_triggered_only = yes
    
	mean_time_to_happen = { 
        days = 1
    }
    
	option = {
		name = wwu_scourge.39.option.a
        
        set_capital = 642
            
        define_ruler = {
            name = "Mal'Ganis"
            adm = 6
            dip = 5
            mil = 4
            age = 500
            claim = 100
        }
        
        set_ruler_flag = is_immortal
        set_ruler_flag = mage_personality
        set_ruler_religion = cult_of_the_damned
        set_ruler_culture = culture_dreadlord
	}
}

#-------------------------------------------
# AI Helpers
#-------------------------------------------
# AI Mission Assist: Kil'Jaeden's Invasion Plan
country_event = {
	id = wwu_scourge.200
	title = wwu_scourge.200.title
	desc = wwu_scourge.200.desc
	picture = LICH_KING_CLOSEUP_eventPicture

    hidden = yes
    is_triggered_only = yes
    
    trigger = {
        ai = yes
    }
    
	mean_time_to_happen = { 
        days = 1
    }
    
	option = {
		name = wwu_scourge.200.option.a
		
        2413 = {
            cede_province = ROOT
        }
        1284 = {
            cede_province = ROOT
        }
	}
}

# AI Mission Assist: Give AI 100 spy network against Lordaeron/Stratholme - approximately every 10 years
country_event = {
	id = wwu_scourge.201
	title = wwu_scourge.201.title
	desc = wwu_scourge.201.desc
	picture = LICH_KING_CLOSEUP_eventPicture

    hidden = yes
    
    trigger = {
        ai = yes
        tag = P11
    }
    
	mean_time_to_happen = { 
        months = 128
    }
    
	option = {
		name = wwu_scourge.201.option.a
		
        if = {
            limit = {
                exists = A08
            }
            add_spy_network_in = {
                who = A08
                value = 100
            }
        }
        if = {
            limit = {
                exists = A10
            }
            add_spy_network_in = {
                who = A10
                value = 100
            }
        }
	}
}

#-------------------------------------------
# Utility
#-------------------------------------------
# Force Scourge of Lordaeron as subject of Scourge
country_event = {
	id = wwu_scourge.300
	title = wwu_scourge.300.title
	desc = wwu_scourge.300.desc
	picture = LICH_KING_CLOSEUP_eventPicture

    hidden = yes
    
    trigger = {
        NOT = { has_global_flag = scourge_of_lordaeron_subject_force }
        exists = P52
        tag = P11
        P52 = {
            NOT = { is_subject_of = P11 }
        }
    }
    
	mean_time_to_happen = { 
        days = 1
    }
    
    immediate = {
        hidden_effect = {
            set_global_flag = scourge_of_lordaeron_subject_force
        }
    }
    
	option = {
		name = wwu_scourge.300.option.a
		
        create_subject = {
            subject_type = vassal
            subject = P52
        }
        
        P52 = {
            add_government_reform = scourge_domain_reform
        }
	}
}

# Scourge Conversion
province_event = {
	id = wwu_scourge.400
	title = wwu_scourge.400.title
	desc = wwu_scourge.400.desc
	picture = LICH_KING_CLOSEUP_eventPicture

    hidden = yes
    
    trigger = {
        is_capital = no
        has_province_flag = primed_for_scourge_conversion
        NOT = {
            owner = {
                tag = P52
            }
        }
    }
    
	mean_time_to_happen = { 
        days = 1
    }
    
    immediate = {
        hidden_effect = {
            clr_province_flag = primed_for_scourge_conversion
        }
    }
    
	option = {
		name = wwu_scourge.400.option.a
		
        add_core = P52
        cede_province = P52
	}
}


